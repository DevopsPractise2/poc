pipeline {
  triggers{ cron('H/15 * * * *') }
  //properties([pipelineTriggers([cron('* * * * *')])])
  options {
    buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))
  }
    agent any 
    stages {
        stage('poll scm') {
            steps {
              script {
                 properties([pipelineTriggers([pollSCM('* * * * *')])])
            }
          }
        }
        stage('Build') { 
            steps {
               sh '''/opt/apache-maven-3.6.3/bin/mvn clean install dockerfile:build'''
            }
        }
        stage('push Image to docker hub') { 
            steps {
                sh '''docker images
                      docker login -u="naidu135" -p="9742450670"
                      docker tag hello-howtodoinjava/hello-docker:latest naidu135/sreetestreo:latest
                      docker push naidu135/sreetestrepo:latest
                   '''
            }
        }
        stage('Deploy') { 
            steps {
                echo "deploy"
                script {
                   //emailext mimetype: 'text/html', subject: "last success", to: "sreevasdev78@gmail.com,nagenderbabu25@gmail.com"
                   emailext body: 'text/html', subject: "last success", to: "sreevasdev78@gmail.com,nagenderbabu25@gmail.com"
                   
                   }
            }
        }
    }
}
